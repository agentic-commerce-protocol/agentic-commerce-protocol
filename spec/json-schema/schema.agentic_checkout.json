{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/agentic-checkout/bundle.schema.json",
  "title": "Agentic Checkout \u2014 Schema Bundle",
  "$defs": {
    "Address": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        },
        "line_one": {
          "type": "string"
        },
        "line_two": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "state": {
          "type": "string"
        },
        "country": {
          "type": "string"
        },
        "postal_code": {
          "type": "string"
        }
      },
      "required": [
        "name",
        "line_one",
        "city",
        "state",
        "country",
        "postal_code"
      ]
    },
    "Buyer": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "first_name": {
          "type": "string"
        },
        "last_name": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone_number": {
          "type": "string"
        }
      },
      "required": [
        "first_name",
        "last_name",
        "email"
      ]
    },
    "Item": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "quantity": {
          "type": "integer",
          "minimum": 1
        }
      },
      "required": [
        "id",
        "quantity"
      ]
    },
    "Disclosure": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "disclaimer"
          ]
        },
        "content_type": {
          "type": "string",
          "enum": [
            "plain",
            "markdown"
          ]
        },
        "content": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "content_type",
        "content"
      ]
    },
    "CustomAttribute": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "display_name": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      },
      "required": [
        "display_name",
        "value"
      ]
    },
    "MarketplaceSellerDetails": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        }
      },
      "required": [
        "name"
      ]
    },
    "PaymentProvider": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": [
            "stripe"
          ]
        },
        "supported_payment_methods": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "card"
            ]
          }
        }
      },
      "required": [
        "provider",
        "supported_payment_methods"
      ]
    },
    "LineItem": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "item": {
          "$ref": "#/$defs/Item"
        },
        "base_amount": {
          "type": "integer"
        },
        "discount": {
          "type": "integer"
        },
        "subtotal": {
          "type": "integer"
        },
        "tax": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "images": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "unit_amount": {
          "type": "integer",
          "description": "The unit price of the line item in the smallest currency unit (e.g., cents for USD)"
        },
        "disclosures": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Disclosure"
          }
        },
        "custom_attributes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CustomAttribute"
          }
        },
        "marketplace_seller_details": {
          "$ref": "#/$defs/MarketplaceSellerDetails"
        }
      },
      "required": [
        "id",
        "item",
        "base_amount",
        "discount",
        "subtotal",
        "tax",
        "total"
      ]
    },
    "Total": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "items_base_amount",
            "items_discount",
            "subtotal",
            "discount",
            "fulfillment",
            "tax",
            "fee",
            "total"
          ]
        },
        "display_text": {
          "type": "string"
        },
        "amount": {
          "type": "integer"
        },
        "description": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "display_text",
        "amount"
      ]
    },
    "FulfillmentOptionShipping": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "shipping"
        },
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "subtitle": {
          "type": "string"
        },
        "carrier": {
          "type": "string"
        },
        "earliest_delivery_time": {
          "type": "string",
          "format": "date-time"
        },
        "latest_delivery_time": {
          "type": "string",
          "format": "date-time"
        },
        "subtotal": {
          "type": "integer"
        },
        "tax": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "id",
        "title",
        "subtotal",
        "tax",
        "total"
      ]
    },
    "FulfillmentOptionDigital": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "digital"
        },
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "subtitle": {
          "type": "string"
        },
        "subtotal": {
          "type": "integer"
        },
        "tax": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "id",
        "title",
        "subtotal",
        "tax",
        "total"
      ]
    },
    "MessageInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "info"
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": [
            "plain",
            "markdown"
          ]
        },
        "content": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "content_type",
        "content"
      ]
    },
    "MessageError": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "error"
        },
        "code": {
          "type": "string",
          "enum": [
            "missing",
            "invalid",
            "out_of_stock",
            "payment_declined",
            "requires_sign_in",
            "requires_3ds"
          ]
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": [
            "plain",
            "markdown"
          ]
        },
        "content": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "code",
        "content_type",
        "content"
      ]
    },
    "Link": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "terms_of_use",
            "privacy_policy",
            "return_policy"
          ]
        },
        "url": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": [
        "type",
        "url"
      ]
    },
    "PaymentData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "token": {
          "type": "string"
        },
        "provider": {
          "type": "string",
          "enum": [
            "stripe"
          ]
        },
        "billing_address": {
          "$ref": "#/$defs/Address"
        }
      },
      "required": [
        "token",
        "provider"
      ]
    },
    "Order": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "checkout_session_id": {
          "type": "string"
        },
        "permalink_url": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "checkout_session_id",
        "permalink_url"
      ]
    },
    "Refund": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "store_credit",
            "original_payment"
          ]
        },
        "amount": {
          "type": "integer"
        }
      },
      "required": [
        "type",
        "amount"
      ]
    },
    "AuthenticationMetadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "Seller-provided authentication metadata for 3DS flows.",
      "properties": {
        "channel": {
          "type": "object",
          "additionalProperties": false,
          "description": "Details about the channel used for this 3DS Authentication.",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "browser"
              ],
              "description": "Use 'browser' to indicate the transaction originated from a browser."
            },
            "browser": {
              "type": "object",
              "additionalProperties": false,
              "description": "Browser details collected server- or client-side.",
              "properties": {
                "accept_header": {
                  "type": "string",
                  "description": "The HTTP Accept header from the cardholder\u2019s browser."
                },
                "ip_address": {
                  "type": "string",
                  "maxLength": 45,
                  "description": "The IP address of the browser."
                },
                "javascript_enabled": {
                  "type": "boolean",
                  "description": "Whether the cardholder browser can execute JavaScript."
                },
                "language": {
                  "type": "string",
                  "maxLength": 35,
                  "description": "An IETF BCP 47 language tag representing the browser language."
                },
                "user_agent": {
                  "type": "string",
                  "description": "The browser user agent string."
                },
                "color_depth": {
                  "type": "integer",
                  "description": "The screen color depth. Required if javascript_enabled is true."
                },
                "java_enabled": {
                  "type": "boolean",
                  "description": "Browser Java support. Required if javascript_enabled is true."
                },
                "screen_height": {
                  "type": "integer",
                  "description": "Screen height in pixels. Required if javascript_enabled is true."
                },
                "screen_width": {
                  "type": "integer",
                  "description": "Screen width in pixels. Required if javascript_enabled is true."
                },
                "timezone_offset": {
                  "type": "integer",
                  "description": "Time difference in minutes between UTC and the browser local time. Required if javascript_enabled is true."
                }
              },
              "required": [
                "accept_header",
                "ip_address",
                "javascript_enabled",
                "language",
                "user_agent"
              ]
            }
          }
        },
        "acquirer_details": {
          "type": "object",
          "additionalProperties": false,
          "description": "Details about the acquirer used for this 3DS Authentication. This object MUST be present when authentication_metadata is provided.",
          "properties": {
            "acquirer_bin": {
              "type": "string",
              "maxLength": 11,
              "description": "The Acquirer BIN (directory-server specific)."
            },
            "acquirer_country": {
              "type": "string",
              "minLength": 2,
              "maxLength": 2,
              "description": "Two-letter ISO 3166-1 alpha-2 country code."
            },
            "acquirer_merchant_id": {
              "type": "string",
              "maxLength": 35,
              "description": "The Merchant ID assigned by the acquirer."
            },
            "merchant_name": {
              "type": "string",
              "maxLength": 40,
              "description": "Merchant name assigned by the acquirer."
            },
            "requestor_id": {
              "type": "string",
              "maxLength": 35,
              "description": "Requestor ID (if required by the directory server)."
            }
          },
          "required": [
            "acquirer_bin",
            "acquirer_country",
            "acquirer_merchant_id",
            "merchant_name"
          ]
        },
        "directory_server": {
          "type": "string",
          "enum": [
            "american_express",
            "mastercard",
            "visa"
          ],
          "description": "The 3DS directory server used for this Authentication. Required when `acquirer_details` is present."
        },
        "flow_preference": {
          "type": "object",
          "additionalProperties": false,
          "description": "Contains additional details on the seller's preference for the 3DS authentication flow. Sellers MAY request a preference, but issuers ultimately decide the actual flow.",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "challenge",
                "frictionless"
              ],
              "description": "Type of flow requested for this 3DS Authentication. 'challenge' requests a challenge flow; 'frictionless' requests a frictionless flow."
            },
            "challenge": {
              "type": "object",
              "additionalProperties": false,
              "description": "Details about the requested challenge flow.",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "mandated",
                    "preferred"
                  ],
                  "description": "Subtype of challenge preference. 'mandated' requests a challenge because it is mandated for this transaction; 'preferred' requests a challenge when not mandated."
                }
              },
              "required": [
                "type"
              ]
            },
            "frictionless": {
              "type": "object",
              "additionalProperties": false,
              "description": "Details about the requested frictionless flow.",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "low_risk"
                  ],
                  "description": "Subtype of frictionless preference. 'low_risk' requests a frictionless flow based on low transaction risk; the seller is responsible for ensuring the transaction meets any required criteria."
                }
              },
              "required": [
                "type"
              ]
            }
          },
          "required": [
            "type"
          ]
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "channel": {
                "properties": {
                  "type": {
                    "const": "browser"
                  }
                }
              }
            }
          },
          "then": {
            "required": [
              "channel"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "channel": {
                "properties": {
                  "type": {
                    "const": "browser"
                  }
                },
                "required": [
                  "type",
                  "browser"
                ]
              }
            }
          },
          "then": {
            "properties": {
              "channel": {
                "required": [
                  "type",
                  "browser"
                ]
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "channel": {
                "properties": {
                  "browser": {
                    "properties": {
                      "javascript_enabled": {
                        "const": true
                      }
                    }
                  }
                }
              }
            }
          },
          "then": {
            "properties": {
              "channel": {
                "properties": {
                  "browser": {
                    "required": [
                      "color_depth",
                      "java_enabled",
                      "screen_height",
                      "screen_width",
                      "timezone_offset"
                    ]
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "acquirer_details": {
                "type": "object"
              }
            }
          },
          "then": {
            "required": [
              "acquirer_details",
              "directory_server"
            ]
          }
        }
      ]
    },
    "AuthenticationResult": {
      "type": "object",
      "additionalProperties": false,
      "description": "Agent-provided authentication results returned to the seller for card-based 3D Secure.",
      "properties": {
        "outcome": {
          "type": "string",
          "description": "The outcome of this 3DS Authentication.",
          "enum": [
            "abandoned",
            "attempt_acknowledged",
            "authenticated",
            "canceled",
            "denied",
            "informational",
            "internal_error",
            "not_supported",
            "processing_error",
            "rejected"
          ]
        },
        "three_ds_cryptogram": {
          "type": "string",
          "description": "The 3DS cryptogram (authentication value / AAV/CAVV/AEVV). This value is 20 bytes, base64-encoded into a 28-character string."
        },
        "electronic_commerce_indicator": {
          "type": "string",
          "description": "Electronic Commerce Indicator (ECI) returned by the 3D Secure provider."
        },
        "transaction_id": {
          "type": "string",
          "description": "Transaction identifier returned by the 3DS system (XID for 3DS1 or dsTransID for 3DS2)."
        },
        "version": {
          "type": "string",
          "description": "The 3D Secure version used for this authentication (for example '2.2.0')."
        }
      },
      "required": [
        "outcome",
        "three_ds_cryptogram",
        "electronic_commerce_indicator",
        "transaction_id",
        "version"
      ]
    },
    "CheckoutSessionBase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "payment_provider": {
          "$ref": "#/$defs/PaymentProvider"
        },
        "status": {
          "type": "string",
          "enum": [
            "not_ready_for_payment",
            "authentication_required",
            "ready_for_payment",
            "completed",
            "canceled",
            "in_progress"
          ]
        },
        "currency": {
          "type": "string"
        },
        "line_items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/LineItem"
          }
        },
        "fulfillment_address": {
          "$ref": "#/$defs/Address"
        },
        "fulfillment_options": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/FulfillmentOptionShipping"
              },
              {
                "$ref": "#/$defs/FulfillmentOptionDigital"
              }
            ]
          }
        },
        "fulfillment_option_id": {
          "type": "string"
        },
        "totals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Total"
          }
        },
        "messages": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/MessageInfo"
              },
              {
                "$ref": "#/$defs/MessageError"
              }
            ]
          }
        },
        "links": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Link"
          }
        },
        "authentication_metadata": {
          "$ref": "#/$defs/AuthenticationMetadata"
        }
      },
      "required": [
        "id",
        "status",
        "currency",
        "line_items",
        "totals",
        "fulfillment_options",
        "messages",
        "links"
      ]
    },
    "CheckoutSession": {
      "allOf": [
        {
          "$ref": "#/$defs/CheckoutSessionBase"
        }
      ]
    },
    "CheckoutSessionWithOrder": {
      "allOf": [
        {
          "$ref": "#/$defs/CheckoutSessionBase"
        },
        {
          "type": "object",
          "properties": {
            "order": {
              "$ref": "#/$defs/Order"
            }
          },
          "required": [
            "order"
          ]
        }
      ]
    },
    "CheckoutSessionCreateRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Item"
          },
          "minItems": 1
        },
        "fulfillment_address": {
          "$ref": "#/$defs/Address"
        }
      },
      "required": [
        "items"
      ]
    },
    "CheckoutSessionUpdateRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Item"
          }
        },
        "fulfillment_address": {
          "$ref": "#/$defs/Address"
        },
        "fulfillment_option_id": {
          "type": "string"
        }
      }
    },
    "CheckoutSessionCompleteRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "payment_data": {
          "$ref": "#/$defs/PaymentData"
        },
        "authentication_result": {
          "$ref": "#/$defs/AuthenticationResult"
        }
      },
      "required": [
        "payment_data"
      ]
    },
    "IntentTrace": {
      "type": "object",
      "properties": {
        "reason_code": {
          "type": "string",
          "description": "Reason for abandonment. This enum is extensible: servers SHOULD accept unrecognized values and treat them as 'other' (see RFC Section 7.2). Validators SHOULD be configured for lenient enum handling.",
          "enum": [
            "price_sensitivity",
            "shipping_cost",
            "shipping_speed",
            "product_fit",
            "trust_security",
            "returns_policy",
            "payment_options",
            "comparison",
            "timing_deferred",
            "other"
          ]
        },
        "trace_summary": {
          "type": "string",
          "maxLength": 500,
          "description": "A generated summary of the specific objection or negotiation gap."
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {
            "type": [
              "string",
              "number",
              "boolean"
            ]
          }
        }
      },
      "required": [
        "reason_code"
      ]
    },
    "CancelSessionRequest": {
      "type": "object",
      "properties": {
        "intent_trace": {
          "$ref": "#/$defs/IntentTrace"
        }
      }
    },
    "Error": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "invalid_request",
            "request_not_idempotent",
            "processing_error",
            "service_unavailable"
          ]
        },
        "code": {
          "type": "string",
          "description": "Implementation-defined error code"
        },
        "message": {
          "type": "string"
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath (optional)"
        }
      },
      "required": [
        "type",
        "code",
        "message"
      ]
    }
  }
}
