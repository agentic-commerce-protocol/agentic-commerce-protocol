openapi: 3.1.0
info:
  title: Agentic Checkout Webhooks API
  version: "2026-01-30"
  description: |
    Webhook receiver hosted by OpenAI to accept merchant order lifecycle events.
servers:
  - url: https://openai.example.com
tags:
  - name: Webhooks
    description: Incoming order events
paths:
  /agentic_checkout/webhooks/order_events:
    post:
      tags: [Webhooks]
      summary: Receive order lifecycle events
      operationId: postOrderEvents
      description: |
        Merchants POST order events so ChatGPT can stay in sync with fulfillment-grade truth.
        Requests MUST be signed with an HMAC signature in the `Merchant-Signature` header.
      parameters:
        - name: Merchant-Signature
          in: header
          required: true
          description: HMAC signature header (e.g., Merchant_Name-Signature) over the raw request body
          schema: { type: string }
        - name: Request-Id
          in: header
          required: false
          description: "Unique identifier for request tracking and debugging"
          schema: { type: string }
        - name: Timestamp
          in: header
          required: false
          description: "ISO 8601 timestamp for request timing validation"
          schema: { type: string, format: date-time }
        - name: Content-Type
          in: header
          required: true
          description: "Must be application/json"
          schema: { type: string, example: "application/json" }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WebhookEvent"
            examples:
              order_created:
                value:
                  type: order_create
                  data:
                    type: order
                    checkout_session_id: "checkout_session_123"
                    permalink_url: "https://example.com/orders/123"
                    status: created
                    refunds: []
              order_updated:
                value:
                  type: order_update
                  data:
                    type: order
                    checkout_session_id: "checkout_session_123"
                    permalink_url: "https://example.com/orders/123"
                    status: shipped
                    refunds:
                      - type: original_payment
                        amount: "1.00"
      responses:
        "200":
          description: Event accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  received: { type: boolean, description: "Confirms the event was received" }
                  request_id: { type: string, description: "Echo of the Request-Id header if provided" }
                required: [received]
        "400":
          description: Bad payload
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          description: Invalid signature
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "429":
          description: Rate limited
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "500":
          description: Server error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }

components:
  schemas:
    Refund:
      type: object
      additionalProperties: false
      properties:
        type: 
          type: string
          enum: [store_credit, original_payment]
          description: "Method of refund: store_credit for future purchases or original_payment to reverse the charge"
        amount: 
          type: integer
          description: "Refund amount in minor units (e.g. 100 cents for $1.00 or 100 for Â¥100)"
      required: [type, amount]
      example:
        type: "original_payment"
        amount: 1050

    EventDataOrder:
      type: object
      additionalProperties: false
      properties:
        type: 
          type: string
          const: order
          description: "Object type discriminator, always 'order'"
        checkout_session_id: 
          type: string
          description: "Unique identifier for the checkout session that created this order"
        permalink_url: 
          type: string
          format: uri
          description: "Persistent URL where the customer can view order details and status"
        status:
          type: string
          enum:
            [created, manual_review, confirmed, canceled, shipped, fulfilled]
          description: "Current state of the order in the fulfillment lifecycle"
        refunds:
          type: array
          description: "List of all refunds applied to this order"
          items: { $ref: "#/components/schemas/Refund" }
      required: [type, checkout_session_id, permalink_url, status, refunds]
      example:
        type: "order"
        checkout_session_id: "cs_01HV3P3ABC123"
        permalink_url: "https://merchant.example.com/orders/ord_123456"
        status: "shipped"
        refunds:
          - type: "original_payment"
            amount: 500

    WebhookEvent:
      type: object
      additionalProperties: false
      properties:
        type: 
          type: string
          enum: [order_create, order_update]
          description: "Event type: order_create for new orders, order_update for changes to existing orders"
        data: 
          $ref: "#/components/schemas/EventDataOrder"
          description: "The order object associated with this event"
      required: [type, data]
      example:
        type: "order_update"
        data:
          type: "order"
          checkout_session_id: "cs_01HV3P3ABC123"
          permalink_url: "https://merchant.example.com/orders/ord_123456"
          status: "shipped"
          refunds: []

    Error:
      type: object
      additionalProperties: false
      properties:
        type:
          type: string
          enum: [invalid_request, processing_error, service_unavailable]
          description: "High-level error category"
        code: 
          type: string
          description: "Specific error code for programmatic handling"
        message: 
          type: string
          description: "Human-readable error message"
        param: 
          type: string
          description: "JSONPath of the offending field if applicable"
      required: [type, code, message]
      example:
        type: "invalid_request"
        code: "missing_required_field"
        message: "The 'amount' field is required"
        param: "$.amount"
