# Changelog

## 2025-12-12

This release introduces several breaking changes to the Agentic Commerce Protocol based on learnings from URBN and Etsy adapter implementations.

### Breaking Changes

#### 1. Renamed `fulfillment_address` to `fulfillment_details`

**Impact:** Both requests (Create/Update) and all responses

**Change:**
- Old structure: Flat `fulfillment_address` object with address fields only
- New structure: Nested `fulfillment_details` object with optional `name`, `phone_number`, `email`, and nested `address` object

**Migration:**
```json
// OLD
{
  "fulfillment_address": {
    "name": "John Doe",
    "line_one": "123 Main St",
    "city": "San Francisco",
    "state": "CA",
    "country": "US",
    "postal_code": "94102"
  }
}

// NEW
{
  "fulfillment_details": {
    "name": "John Doe",
    "phone_number": "15551234567",
    "email": "john@example.com",
    "address": {
      "name": "John Doe",
      "line_one": "123 Main St",
      "city": "San Francisco",
      "state": "CA",
      "country": "US",
      "postal_code": "94102"
    }
  }
}
```

#### 2. Replaced `fulfillment_option_id` with `selected_fulfillment_options`

**Impact:** Update requests and all responses

**Change:**
- Old: Single string `fulfillment_option_id` field
- New: Array `selected_fulfillment_options[]` with type-specific nested structures supporting multiple selections and item-level mappings

**Migration:**
```json
// OLD
{
  "fulfillment_option_id": "fulfillment_option_123"
}

// NEW
{
  "selected_fulfillment_options": [
    {
      "type": "shipping",
      "shipping": {
        "option_id": "fulfillment_option_123",
        "item_ids": ["item_456"]
      }
    }
  ]
}
```

**Rationale:** Supports selecting different fulfillment options for different items in the same cart, essential for complex fulfillment scenarios.

#### 3. Made `subtotal` and `tax` optional in FulfillmentOption

**Impact:** Both `FulfillmentOptionShipping` and `FulfillmentOptionDigital` schemas

**Change:**
- Old: `subtotal` and `tax` were required fields
- New: `subtotal` and `tax` are optional; only `total` is required

**Migration:**
```json
// OLD - both subtotal and tax required
{
  "type": "shipping",
  "id": "fulfillment_option_123",
  "title": "Standard Shipping",
  "subtotal": 100,
  "tax": 0,
  "total": 100
}

// NEW - can omit subtotal and tax if not available
{
  "type": "shipping",
  "id": "fulfillment_option_123",
  "title": "Standard Shipping",
  "total": 100
}
```

**Rationale:** Not all sellers provide tax/subtotal breakdown for fulfillment options. Only the total amount is essential.

#### 4. Added `selected_fulfillment_options` to UpdateCheckout request

**Impact:** `CheckoutSessionUpdateRequest` schema

**Change:**
- Old: Could only update via `fulfillment_option_id` (now removed)
- New: Update via `selected_fulfillment_options[]` array

### Additional Changes

#### Bug Fix: Fulfillment Amount Types

Fixed inconsistency in OpenAPI spec where fulfillment option amounts (`subtotal`, `tax`, `total`) were incorrectly typed as strings instead of integers. The JSON Schema and RFC always specified integers in minor units.

#### Added: Total Description Field

Added optional `description` field to the `Total` type to provide additional context for line items, especially fees (e.g., "Processing and handling fee").

#### Added: `return_policy` Link Type

Added `return_policy` as a new link type option alongside `terms_of_use` and `privacy_policy`. Removed `seller_shop_policies` link type (redundant).

#### Added: LineItem Display Fields

Added optional display fields to `LineItem` for richer product presentation:
- `name`, `description`, `images`, `unit_amount`
- `disclosures`, `custom_attributes`, `marketplace_seller_details`

#### Added: Intent Traces

Added support for structured cancellation context via `intent_trace` on the cancel endpoint, allowing agents to communicate why a session is being abandoned.

#### Added: Affiliate Attribution

Added support for the Affiliate Attribution extension, enabling agents to credit third-party publishers without relying on cookies or client-side tracking. Supports first-touch (session creation) and last-touch (completion) attribution.

### Version Compatibility

- Clients MUST send `API-Version: 2025-12-12` header
- Previous version `2025-09-29` is deprecated
- Breaking changes require client updates

### Files Updated

- `spec/json-schema/schema.agentic_checkout.json`
- `spec/openapi/openapi.agentic_checkout.yaml`
- `examples/examples.agentic_checkout.json`
- `rfcs/rfc.agentic_checkout.md`

### Reference

- Commit: [fb790cc](https://github.com/agentic-commerce-protocol/agentic-commerce-protocol/commit/fb790cc)
