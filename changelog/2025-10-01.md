# Changelog - October 1, 2025

## Added UPI Payment Method Support

**Date:** October 1, 2025  
**Version:** 2025-10-01  
**Author:** Jatin Goel (Razorpay), Engineering

### Summary

Added support for UPI (Unified Payments Interface) payment method to the Agentic Commerce Protocol, enabling delegated UPI payments for AI agents like ChatGPT in the Indian market. This enhancement allows merchants to accept UPI payments alongside card payments through Razorpay as a payment provider.

### Key Changes

#### 1. Delegate Payment Spec

- **Added `PaymentMethodUPI`**: New payment method type supporting delegated UPI payments
  - `type`: "upi" (required)
  - `delegate_id`: Unique identifier for the user's delegation setup on the AI agent
  - `cryptogram`: One-time cryptogram for transaction security
  
- **Updated `DelegatePaymentRequest`**: Now accepts both `PaymentMethodCard` and `PaymentMethodUPI` via `oneOf` discriminator

#### 2. Agentic Checkout Spec

- **Added `razorpay`** as a supported payment provider (alongside `stripe`)
- **Added `upi`** to supported payment methods array (alongside `card`)
- **Updated `PaymentProvider`** schema to support:
  - `provider`: "stripe" | "razorpay"
  - `supported_payment_methods`: ["card"] | ["card", "upi"]
  
- **Updated `PaymentData`** to support Razorpay tokens

#### 3. Examples

Added comprehensive examples for UPI payment flows:

- **Delegate Payment Examples**:
  - `delegate_payment_upi_request`: Request with UPI delegate_id and cryptogram
  - `delegate_payment_upi_success_response`: Successful vault token creation
  - `delegate_payment_upi_error_invalid_delegate`: Error handling for invalid delegate_id

- **Agentic Checkout Examples**:
  - `create_checkout_session_razorpay_upi_response`: Checkout session with Razorpay/UPI support
  - `complete_checkout_session_razorpay_upi_request`: Completing checkout with UPI payment
  - `complete_checkout_session_razorpay_upi_response`: Successful order creation with UPI

#### 4. RFC Documentation

- **Updated `rfc.delegate_payment.md`**:
  - Added comprehensive UPI payment method documentation (§3.4)
  - Added UPI-specific validation rules (§7.3)
  - Added UPI examples (§8.4, §8.5)
  - Updated conformance checklist
  
- **Updated `rfc.agentic_checkout.md`**:
  - Added Razorpay provider support
  - Added UPI payment method documentation
  - Added note on UPI payment flow in Complete Session section

### Technical Details

#### UPI Payment Flow

1. **Setup Phase**: User sets up Delegated UPI on ChatGPT through Razorpay AI Commerce TSP
   - User authenticates via UPI app
   - Configures monthly limits and authorizations
   - Receives `delegate_id` for subsequent transactions

2. **Payment Phase**: During checkout
   - ChatGPT fetches one-time `cryptogram` from Razorpay AI Commerce TSP
   - Sends delegated payment request with `delegate_id` and `cryptogram`
   - Merchant's payment provider (Razorpay) validates and processes payment
   - Order is created and confirmed

#### Currency Support

- UPI payments typically use INR (Indian Rupees)
- All amounts remain in minor units (e.g., ₹1000 = 100000 paise)

#### Security

- Each transaction uses a fresh cryptogram for security
- Delegate tokens are scoped to allowance constraints
- Payment authorization happens through the user's UPI app with MPIN verification

### Backward Compatibility

This change is **fully backward compatible**:
- Existing card payment flows remain unchanged
- `stripe` provider continues to work as before
- New `razorpay` provider and `upi` method are additive features
- API version updated from `2025-09-29` to `2025-10-01`

### Files Modified

#### Specifications
- `spec/openapi/openapi.delegate_payment.yaml`
- `spec/openapi/openapi.agentic_checkout.yaml`
- `spec/json-schema/schema.delegate_payment_schema.json`
- `spec/json-schema/schema.agentic_checkout.json`

#### Examples
- `examples/examples.delegate_payment.json`
- `examples/examples.agentic_checkout.json`

#### Documentation
- `rfcs/rfc.delegate_payment.md`
- `rfcs/rfc.agentic_checkout.md`

### Integration Guide

For merchants wanting to support UPI payments:

1. **Payment Provider Setup**: Integrate with Razorpay as your payment provider
2. **Update Checkout Sessions**: Return `razorpay` as provider with `["card", "upi"]` in supported_payment_methods
3. **Handle UPI Tokens**: Process vault tokens from delegated UPI payments
4. **Test**: Use provided examples to validate integration

### Related Links

- OpenAI Agentic Commerce Protocol: https://openai.com/agentic-commerce
- NPCI UPI Specification: https://www.npci.org.in/what-we-do/upi
- Razorpay Payment Gateway: https://razorpay.com

### Notes

This implementation is part of Razorpay and NPCI's collaborative effort to enable AI-driven commerce in India through Delegated UPI payments. The solution maintains India's data localization requirements while enabling seamless AI agent payment experiences.

